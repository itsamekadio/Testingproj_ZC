<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Main.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">crypto-checker</a> &gt; <a href="index.source.html" class="el_package">com.cryptochecker</a> &gt; <span class="el_source">Main.java</span></div><h1>Main.java</h1><pre class="source lang-java linenums">package com.cryptochecker;

import java.awt.*; // user interfaces, painting and images. (color, font, borderlayout)
import java.awt.image.BufferedImage;
import java.io.*;
import java.util.ArrayList;
import javax.imageio.ImageIO;
import javax.swing.*; // provides gui related components (frame, jbutton)

<span class="fc" id="L10">public class Main {</span>
    public static Main gui;
    public static JFrame frame;

    public Debug debug;
    public WebData webData;
    public Menu menu;
    public PanelCoin panelCoin;
    public PanelPortfolio panelPortfolio;
    public PanelConverter panelConverter;
    public PanelSettings panelSettings;

<span class="fc" id="L22">    public static String currency = &quot;USD&quot;;</span>
<span class="fc" id="L23">    public static String currencyChar = &quot;$&quot;;</span>

<span class="fc" id="L25">    public static enum themes { LIGHT, DARK, CUSTOM };</span>
    public static Theme theme;

<span class="fc" id="L28">    public static Dimension screenResolution = getScreenResolution();</span>

    public static final int panelWidth = 110;
    public static final int panelHeight = 30;

<span class="fc" id="L33">    public static final Font tableFont = new Font(&quot;Helvetica&quot;, Font.PLAIN, 16);</span>
<span class="fc" id="L34">    public static final Dimension tableHeaderSize = new Dimension(25, 25);</span>
<span class="fc" id="L35">    public static final Dimension tableIntercellSpacing = new Dimension(5, 5);</span>

<span class="fc" id="L37">    public static final String folderLocation = System.getProperty(&quot;user.home&quot;)+&quot;/.crypto-checker/&quot;;</span>
<span class="fc" id="L38">    public static final String dataSerLocation = folderLocation+&quot;data.ser&quot;;</span>
<span class="fc" id="L39">    public static final String portfolioSerLocation = folderLocation+&quot;portfolio.ser&quot;;</span>
<span class="fc" id="L40">    public static final String settingsSerLocation = folderLocation+&quot;settings.ser&quot;;</span>
<span class="fc" id="L41">    public static final String converterSerLocation = folderLocation+&quot;converter.ser&quot;;</span>
<span class="fc" id="L42">    public static final String imageLocation = folderLocation+&quot;icon.png&quot;;</span>
<span class="fc" id="L43">    public static final String logLocation = folderLocation+&quot;log.txt&quot;;</span>

    private static Dimension getScreenResolution() {
        try {
<span class="nc" id="L47">            return Toolkit.getDefaultToolkit().getScreenSize();</span>
<span class="fc" id="L48">        } catch (java.awt.HeadlessException e) {</span>
<span class="fc" id="L49">            return new Dimension(1920, 1080);</span>
        }
    }

    public static void main(String[] args) {
<span class="nc bnc" id="L54" title="All 2 branches missed.">        if (!(new File(folderLocation).exists())) {</span>
<span class="nc" id="L55">            new File(folderLocation).mkdirs();</span>
        }
        
<span class="nc" id="L58">        gui = new Main();</span>

        try {
<span class="nc" id="L61">            gui.setupGUI(); // create gui</span>
<span class="nc" id="L62">        } catch(Exception ex) {</span>
<span class="nc" id="L63">            ex.printStackTrace();</span>
        }
<span class="nc" id="L65">    }</span>

    private void setupGUI() throws Exception {
<span class="nc" id="L68">        debug = new Debug(); // log file</span>

<span class="nc" id="L70">        frame = new JFrame(&quot;Crypto Checker&quot;); // create frame of program</span>
<span class="nc" id="L71">        frame.setSize(900,600);</span>
<span class="nc" id="L72">        frame.setLocationRelativeTo(null); // screen location to middle</span>
<span class="nc" id="L73">        frame.setResizable(false); // disallow changes to size</span>
<span class="nc" id="L74">        frame.setVisible(true);</span>
<span class="nc" id="L75">        frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);</span>

<span class="nc" id="L77">        deserializeSettings();</span>

<span class="nc" id="L79">        getIcon();</span>
<span class="nc" id="L80">        webData = new WebData();</span>

<span class="nc" id="L82">        deserializePortfolio();</span>

<span class="nc" id="L84">        menu = new Menu();</span>
<span class="nc" id="L85">        panelCoin = new PanelCoin();</span>
<span class="nc" id="L86">        panelPortfolio = new PanelPortfolio();</span>
<span class="nc" id="L87">        panelConverter = new PanelConverter();</span>
<span class="nc" id="L88">        panelSettings = new PanelSettings();</span>

<span class="nc bnc" id="L90" title="All 2 branches missed.">        if (!Debug.mode) new WebData.RefreshCoins(); // refresh upon startup unless in debug mode</span>

        // add the panels to the frame
<span class="nc" id="L93">        frame.getContentPane().add(BorderLayout.CENTER, panelCoin.panel);</span>
<span class="nc" id="L94">        frame.getContentPane().add(BorderLayout.WEST, menu.panel);</span>

<span class="nc" id="L96">        Main.frame.getContentPane().revalidate();</span>
<span class="nc" id="L97">        Main.frame.getContentPane().repaint();</span>
<span class="nc" id="L98">    }</span>

    private void deserializeSettings() throws Exception { // restore theme setting from data
<span class="pc bpc" id="L101" title="1 of 2 branches missed.">        if (!(new File(settingsSerLocation).canRead())) {</span>
<span class="fc" id="L102">            theme = new Theme(themes.LIGHT);</span>
<span class="fc" id="L103">            Debug.log(&quot;ERROR: Couldn't find &quot;+settingsSerLocation+&quot;.. skipping&quot;);</span>
<span class="fc" id="L104">        } else {</span>

            try {
<span class="nc" id="L107">                FileInputStream file = new FileInputStream(settingsSerLocation);</span>
<span class="nc" id="L108">                BufferedInputStream buffer = new BufferedInputStream(file);</span>
<span class="nc" id="L109">                ObjectInputStream in = new ObjectInputStream(buffer);</span>
    
<span class="nc" id="L111">                Debug.mode = (Boolean) in.readObject();</span>
<span class="nc" id="L112">                theme = (Theme) in.readObject();</span>
<span class="nc" id="L113">                currency = (String) in.readObject();</span>
<span class="nc" id="L114">                currencyChar = (String) in.readObject();</span>
<span class="nc" id="L115">                in.close();</span>
<span class="nc" id="L116">                Debug.log(&quot;Deserialized Settings From &quot; + settingsSerLocation);</span>

<span class="nc bnc" id="L118" title="All 2 branches missed.">                if (Debug.mode) Debug.frame.setVisible(true); // if debug mode on, show debug frame</span>
<span class="nc" id="L119">            } catch(Exception ex) {</span>
<span class="nc" id="L120">                Debug.log(&quot;ERROR: Main.deserializeSettings(), deleting &quot; + settingsSerLocation);</span>
<span class="nc" id="L121">                File deleteFile = new File(settingsSerLocation);</span>
<span class="nc" id="L122">                deleteFile.delete();</span>

<span class="nc" id="L124">                theme = new Theme(themes.LIGHT);</span>
            }
        }

<span class="fc" id="L128">        UIManager.put(&quot;OptionPane.background&quot;,theme.emptyBackground);</span>
<span class="fc" id="L129">        UIManager.put(&quot;Panel.background&quot;,theme.emptyBackground);</span>
<span class="fc" id="L130">        UIManager.put(&quot;OptionPane.messageForeground&quot;,theme.foreground);</span>
<span class="fc" id="L131">    }</span>

    @SuppressWarnings(&quot;unchecked&quot;) // coin = (ArrayList&lt;Coin&gt; in.readObject()) supressing
    private void deserializePortfolio() throws Exception {
<span class="pc bpc" id="L135" title="1 of 2 branches missed.">        if (!(new File(portfolioSerLocation).canRead())) {</span>
<span class="fc" id="L136">            webData.portfolio = new ArrayList&lt;ArrayList&lt;WebData.Coin&gt;&gt;();</span>
<span class="fc" id="L137">            webData.portfolio.add(new ArrayList&lt;WebData.Coin&gt;());</span>
<span class="fc" id="L138">            webData.portfolio_names.add(new String(&quot;Portfolio 1&quot;));</span>
<span class="fc" id="L139">            Debug.log(&quot;ERROR: Couldn't find &quot;+portfolioSerLocation+&quot;.. skipping&quot;);</span>
<span class="fc" id="L140">        } else {</span>

            try {
<span class="nc" id="L143">                FileInputStream file = new FileInputStream(portfolioSerLocation);</span>
<span class="nc" id="L144">                BufferedInputStream buffer = new BufferedInputStream(file);</span>
<span class="nc" id="L145">                ObjectInputStream in = new ObjectInputStream(buffer);</span>
        
<span class="nc" id="L147">                webData.portfolio = (ArrayList&lt;ArrayList&lt;WebData.Coin&gt;&gt;) in.readObject();</span>
<span class="nc" id="L148">                webData.portfolio_names = (ArrayList&lt;String&gt;) in.readObject();</span>
<span class="nc" id="L149">                webData.portfolio_nr = (Integer) in.readObject();</span>
<span class="nc" id="L150">                in.close();</span>
<span class="nc" id="L151">                Debug.log(&quot;Deserialized Portfolio From &quot; + portfolioSerLocation);</span>
<span class="nc" id="L152">            }</span>
<span class="nc" id="L153">            catch(Exception ex) {</span>
<span class="nc" id="L154">                Debug.log(&quot;ERROR: Main.deserializePortfolio(), deleting &quot; + portfolioSerLocation);</span>
<span class="nc" id="L155">                File deleteFile = new File(portfolioSerLocation);</span>
<span class="nc" id="L156">                deleteFile.delete();</span>

<span class="nc" id="L158">                webData.portfolio = new ArrayList&lt;ArrayList&lt;WebData.Coin&gt;&gt;();</span>
<span class="nc" id="L159">                webData.portfolio.add(new ArrayList&lt;WebData.Coin&gt;());</span>
<span class="nc" id="L160">                webData.portfolio_names.add(new String(&quot;Portfolio 1&quot;));</span>
            }
        }
<span class="fc" id="L163">    }</span>

    private void getIcon() throws Exception { // program icon
<span class="fc bfc" id="L166" title="All 2 branches covered.">        if (!(new File(imageLocation).exists())) {</span>
            try {
<span class="fc" id="L168">                Debug.log(&quot;ERROR: Couldn't find &quot;+imageLocation+&quot;.. downloading&quot;); // get image from jar</span>
<span class="fc" id="L169">                BufferedImage image = ImageIO.read(getClass().getResource(&quot;/icon.png&quot;));</span>

<span class="fc" id="L171">                ImageIO.write(image, &quot;png&quot;, new File(imageLocation)); // write the image to location</span>
<span class="fc" id="L172">                Debug.log(&quot;-- image downloaded&quot;);</span>
<span class="pc" id="L173">            } catch(Exception ex) {</span>
<span class="nc" id="L174">                Debug.log(&quot;ERROR: Couldn't find /icon.png in jar&quot;);</span>
<span class="nc" id="L175">                return;</span>
            }
        }
        
<span class="pc bpc" id="L179" title="1 of 2 branches missed.">        if (imageLocation != null) { // do this if the image exists</span>
<span class="fc" id="L180">            frame.setIconImage(Toolkit.getDefaultToolkit().getImage(imageLocation));</span>
        }
<span class="fc" id="L182">    }</span>

    public static class Theme implements Serializable {
        private static final long serialVersionUID = 1L;
        public themes currentTheme;
        public Color background;
        public Color foreground;
        public Color green;
        public Color red;
        public Color selection;
        public Color emptyBackground;

<span class="fc" id="L194">        private Color defaultCustomBackground = new Color(0, 0, 0); // black </span>
<span class="fc" id="L195">        private Color defaultCustomForeground = new Color(14, 255, 0); // light green</span>
<span class="fc" id="L196">        private Color defaultCustomGreen = new Color(244, 255, 0); // light yellow</span>
<span class="fc" id="L197">        private Color defaultCustomRed = new Color(255, 0, 0); // light red</span>
<span class="fc" id="L198">        private Color defaultCustomSelection = new Color(128, 128, 128); // gray</span>
<span class="fc" id="L199">        private Color defaultCustomEmptyBackground = new Color(45, 45, 45); // dark gray</span>

        public Color customBackground;
        public Color customForeground;
        public Color customGreen;
        public Color customRed;
        public Color customSelection;
        public Color customEmptyBackground;

<span class="fc" id="L208">        public Theme(themes currentTheme) {</span>
<span class="fc" id="L209">            resetCustom();</span>
<span class="fc" id="L210">            this.currentTheme = currentTheme;</span>
<span class="fc" id="L211">            update();</span>
<span class="fc" id="L212">        }</span>

        public void change(themes currentTheme) {
<span class="fc" id="L215">            this.currentTheme = currentTheme;</span>
<span class="fc" id="L216">            update();</span>
<span class="fc" id="L217">        }</span>

        public void update() {
<span class="pc bpc" id="L220" title="1 of 4 branches missed.">            switch (currentTheme) {</span>
                case LIGHT:
<span class="fc" id="L222">                    background = Color.WHITE; // white</span>
<span class="fc" id="L223">                    foreground = Color.BLACK; // black</span>
<span class="fc" id="L224">                    green = new Color(0, 128, 0); // dark green</span>
<span class="fc" id="L225">                    red = new Color(220, 20, 60); // dark red</span>
<span class="fc" id="L226">                    selection = Color.GRAY; // gray</span>
<span class="fc" id="L227">                    emptyBackground = new Color(250, 250, 250); // quite white</span>
<span class="fc" id="L228">                    break;</span>
                case DARK:
<span class="fc" id="L230">                    background = new Color(15, 15, 15); // light black</span>
<span class="fc" id="L231">                    foreground = Color.WHITE; // white</span>
<span class="fc" id="L232">                    green = Color.GREEN; // light green</span>
<span class="fc" id="L233">                    red = Color.RED; // dark red</span>
<span class="fc" id="L234">                    selection = Color.GRAY; // gray</span>
<span class="fc" id="L235">                    emptyBackground = new Color(78, 78, 78); // dark gray</span>
<span class="fc" id="L236">                    break;</span>
                case CUSTOM:
<span class="fc" id="L238">                    background = customBackground;</span>
<span class="fc" id="L239">                    foreground = customForeground;</span>
<span class="fc" id="L240">                    green = customGreen;</span>
<span class="fc" id="L241">                    red = customRed;</span>
<span class="fc" id="L242">                    selection = customSelection;</span>
<span class="fc" id="L243">                    emptyBackground = customEmptyBackground;</span>
                    break;
            }
<span class="fc" id="L246">        }</span>

        public void resetCustom() {
<span class="fc" id="L249">            customBackground = defaultCustomBackground;</span>
<span class="fc" id="L250">            customForeground = defaultCustomForeground;</span>
<span class="fc" id="L251">            customGreen = defaultCustomGreen;</span>
<span class="fc" id="L252">            customRed = defaultCustomRed;</span>
<span class="fc" id="L253">            customSelection = defaultCustomSelection;</span>
<span class="fc" id="L254">            customEmptyBackground = defaultCustomEmptyBackground;</span>
<span class="fc" id="L255">        }</span>
    } 

    public JButton getButtonTemplate(String s) {
<span class="fc" id="L259">        JButton template = new JButton(s);</span>
<span class="fc" id="L260">        template.setMinimumSize(new Dimension(panelWidth, panelHeight));</span>
<span class="fc" id="L261">        template.setMaximumSize(new Dimension(panelWidth, panelHeight));</span>
<span class="fc" id="L262">        template.setBackground(Color.GRAY);</span>
<span class="fc" id="L263">        template.setForeground(Color.WHITE);</span>
<span class="fc" id="L264">        template.setFocusable(false);</span>

<span class="fc" id="L266">        return template;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>